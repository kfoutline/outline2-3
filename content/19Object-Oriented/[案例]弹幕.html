<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>弹幕</title>
	<style>
	.container{width:800px;margin:0 auto;padding-bottom:10px;background-color:#dfdfdf;}
	#barrage{position:relative;height:600px;margin-bottom:10px;background-color:#000;overflow:hidden;}
	#barrage .bar-item{position:absolute;left:100%;white-space:nowrap;}
	#msg{margin-left:10px;width:400px;height:30px;border:1px solid #999;border-right:none;box-sizing:border-box;vertical-align:middle;}
	#msg+button{padding:0 10px;height:30px;vertical-align:middle;}
	</style>
	<script>
		/*
			弹幕
				效果：
					1）随机颜色，速度，字体大小，位置
					2）从右往左移动
				思路：
					1）发送
						1>绑定点击事件
						2>发送消息，把消息当作一个对象
					2）生成消息对象
						初始化：确定颜色，速度，字体大小，位置
					3）运动
						从右往左移动
		 */
		window.onload = function(){
			// 获取页面元素
			var barrage = document.querySelector('#barrage');
			var msg = document.querySelector('#msg');
			var btn = msg.nextElementSibling;

			// 1）发送
			// 创建一个消息对象
			btn.onclick = function(){
				var _msg = msg.value;
				new Barrage(_msg);

				// 清空输入框
				msg.value = '';

				// 保持焦点
				msg.focus();
			}

			// 点击回车键发送消息
			msg.onkeyup = function(e){
				e = e || window.event;

				if(e.keyCode === 13){
					btn.onclick();
				}
			}

			// 消息构造函数
			function Barrage(msg){
				// 描述属性

				// 字体颜色
				this.color = randomColor();

				// 字体大小
				this.fontSize = randomNum(12,36);

				// 移动速度
				this.speed = randomNum(2,15);

				// 文字出现的位置
				this.top = randomNum(10,barrage.offsetHeight-this.fontSize);

				this.init(msg);
			}

			// 描述方法

			// 初始化
			// DOM节点的创建
			Barrage.prototype.init = function(msg){
				var span = document.createElement('span');
				span.className = 'bar-item';
				span.innerHTML = msg;

				// 设置随机属性
				span.style.fontSize = this.fontSize + 'px';
				span.style.color = this.color;
				span.style.top = this.top + 'px';

				// 通过this传递dom节点
				this.ele = span;

				// 把span写入页面
				barrage.appendChild(span);
				this.move();
			}

			// 移动
			Barrage.prototype.move = function(){
				var self = this;
				var span = self.ele;
				self.timer = setInterval(function(){
					// 先获取span当前left值
					var currentLeft = span.offsetLeft;

					// 当消息移动到#barrage以外的区域时，清除dom节点并清除定时器
					if(currentLeft <= -span.offsetWidth){
						self.remove();
						return;
					}

					span.style.left = currentLeft - self.speed + 'px';

				},50);
			}

			// 移除
			Barrage.prototype.remove = function(){
				// 清除dom节点并清除定时器
				barrage.removeChild(this.ele);
				clearInterval(this.timer);
			}

			// 随机函数
			function randomNum(min,max){
				var result = parseInt(Math.random()*(max-min+1)) + min;//0~1
				return result;
			}
			// randomNum(10,20);//11,10,13,20...
			
			// 随机颜色
			function randomColor(){
				var str = '0123456789abcdef';
				var result = '#';
				for(var i=0;i<6;i++){
					result += str[randomNum(0,str.length-1)];
				}
				return result;
			}
		}
	</script>
</head>
<body>
	<div class="container">
		<div id="barrage"></div>
		<input type="text" id="msg"><button>发送</button>
	</div>
</body>
</html>